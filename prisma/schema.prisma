// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String             @id @default(cuid())
  f_name                 String
  l_name                 String
  gender                 String
  email                  String?            @unique
  phone_number           String             @unique
  national_id            String?            @unique
  password               String
  role                   String             @default("Unassigned")
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  BioData                BioData[]
  Appointments           Appointments[]
  Incidents              Incidents[]
  Reporter               Incidents[]        @relation("reporter")
  FollowUpRequests       FollowUpRequests[]
  FollowUpRequestsMother FollowUpRequests[] @relation("mother")
  facilityAdmin          String?
  CHVTargets             CHVTargets[]
  Facility               Facility?          @relation(fields: [facilityId], references: [id])
  facilityId             String?
}

model BioData {
  id                     String   @id @default(cuid())
  user                   User     @relation(fields: [userId], references: [id])
  userId                 String
  height                 Int
  weight                 Int
  active                 Boolean  @default(true)
  age                    Int
  last_monthly_period    DateTime
  expected_delivery_date DateTime
  pregnancy_period       Int // pregnancy period in weeks
  last_clinic_visit      DateTime
  facility               Facility @relation(fields: [facilityId], references: [id])
  facilityId             String
  previous_pregnancies   Int      @default(0)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model Facility {
  id                  String                @id @default(cuid())
  name                String                @unique
  BioData             BioData[]
  Appointments        Appointments[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  status              String                @default("Active")
  FollowUpRequests    FollowUpRequests[]
  LocationCoordinates LocationCoordinates[]
  users               User[]
}

model Appointments {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  facility    Facility @relation(fields: [facilityId], references: [id])
  facilityId  String
  date        DateTime
  status      String
  purpose     String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Incidents {
  id                String   @id @default(cuid())
  reportedBy        User     @relation(fields: [reportedById], references: [id], "reporter")
  reportedById      String
  mother_affected   User     @relation(fields: [motherId], references: [id])
  motherId          String
  description       String
  incident_time     DateTime
  incident_duration String //TODO ask for clarification on incident times
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model FollowUpRequests {
  id          String   @id @default(cuid())
  facility    Facility @relation(fields: [facilityId], references: [id])
  facilityId  String
  user        User     @relation(fields: [chvId], references: [id])
  chvId       String // This is the CHV user
  mother      User     @relation(fields: [userId], references: [id], "mother")
  userId      String
  status      String   @default("Pending")
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Resources {
  id          String   @id @default(cuid())
  title       String
  description String
  files       String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CHVTargets {
  id        String   @id @default(cuid())
  chv       User     @relation(fields: [userId], references: [id])
  setTarget Int      @default(0) //Number of mothers to register
  current   Int      @default(0) //Mothers currently registered
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
}

model LocationCoordinates {
  id         String   @id @default(cuid())
  lat        Float
  lng        Float
  facility   Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  facilityId String   @unique
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

//TODO ask to create a table to record clinical visits
